# マップ作成チュートリアル

![みんなでつくるダンジョン](./images/mindan_summary.png)

アクションゲームのような横視点の二次元マップをつくって公開したり、ほかのひとが作ったマップを探検することができます。
マップ同士はつなげることができるので、どんどんつなげて巨大なダンジョンをつくってあそぼう～！というウェブサービスです。

「プラグイン」という仕組みをつかうことで、マップ内に動きを付けることができ、かんたんなゲームっぽいマップをつくることもできます。

まずはマップであそんでみましょう。以下のリンクからマップを遊ぶことができます。こんな感じのマップが作れるのだな、という雰囲気をつかんでいただけると思います。

- [https://dungeon.garakuta-toolbox.com/maps/1](https://dungeon.garakuta-toolbox.com/maps/1)
- [https://dungeon.garakuta-toolbox.com/maps/14](https://dungeon.garakuta-toolbox.com/maps/14)

:::tip おしらせ
上記のようにマップのリンクを貼ることで、作ったマップをTwitterなどのSNSで共有することができます。
:::

## アカウントをつくる

:::tip おしらせ
マップの作成のようすをYouTubeで公開中です。こちらも併せてみてみてください。
[みんなでつくるダンジョンでマップをつくってみたよ](https://youtu.be/5C7XviGnCLw)
:::

まずはアカウントを作成します。[トップページ](https://dungeon.garakuta-toolbox.com) の以下のボタンからアカウントを作成します。

![アカウントの作成](./images/register.png)

アカウントを作成すると、以下のことができるようになります。

- マップをつくって公開できます
- [キャラクタ](../avatar/)をカスタマイズしてマップ内をたんけんできます
- [アイテム](../item-collection)を拾ったり、[いいねカウンタ](../counter/)が設置されているマップでいいねできます
- [素材を公開](../registeration-textures/)できます

## ログインする

登録が終わったら、ログインをします。[ログイン画面はこちら](https://dungeon.garakuta-toolbox.com/maps)

![ログイン](./images/login.png)

ログインしたら、「マップをつくる」を選びます。

![マップをつくる](./images/makemap.png)

## パーツを置く

まずは「パーツ」を配置してみましょう。パーツを並べることで、マップの床や壁などをつくります。

「パーツの追加」ボタンを押すと、マップ上にはてなマークのパーツがひとつ追加されます。

![パーツの配置](./images/add-parts.png)

パーツはマウス（スマートフォンの場合はタッチ）のドラッグ操作あるいは、パーツの周囲に表示されている数字を書き換えることで、大きさや位置を変更できます。

![パーツの大きさ変更](./images/size.gif)

パーツに[アニメーション](../animation/)を設定することで、静止画やアニメーションを設定できます。

## 画像をアップロードする

まずは画像をアップロードします。もしくは、みんなでつくるダンジョン公式アカウントが提供している画像をコピーします。
（提供している画像は、コピーの際に利用規約が表示されるのでご確認ください）

:::tip おしらせ
素材の規格については、[画像](../texture/)を見てみてください。
:::

「画像の管理」ボタンを押します。

![画像の管理ボタン](./images/image-button.png)

お手持ちの画像がなくても、公開されている素材をつかうことができます。
今回は、公式素材の「マップチップ」を選択してみましょう。
表示された画面の「素材」タブを選択し、「マップチップ」という素材を選択して「コピー」ボタンを押します。

コピーボタンは、PCの場合は対象の素材の上にマウスカーソルを置いたとき、スマートフォンの場合は対象の素材をタップしたときに表示されます。

![素材の選択](./images/selectchip.png)

コピーが完了すると、「じぶんの画像」一覧にコピーした画像が表示されます。
コピーした画像には「ライセンスの確認」ボタンが表示されます。利用条件を改めて確認したいときに押してみてください。

![コピーされた画像](./images/copied.png)

:::tip じぶんの画像をつかうとき

表示された画面で、画像の追加ボタンを押すか、ファイルをドラッグ＆ドロップします。

![画像のアップロード](./images/upload.png)
:::

## アニメーションをつくる

つぎにアニメーションを作成してみましょう。まずは「アニメーション」ボタンを押します。

![アニメーションの作成](./images/animation-button.png)

以下の手順でアニメーションを追加し、アニメーションに利用する画像を読み込みます。

![アニメーションの作成](./images/add-animation.gif)

アニメーションの一コマを「フレーム」といいます。画像をドラッグ＆ドロップしてフレームを追加してみましょう。

![フレームの追加](./images/add-frame.gif)

名前を変更して、追加ボタンを押します。

![アニメーションの追加](./images/add-animation-dialog.png)

## アニメーションの適用

作成したアニメーションをパーツに適用します。以下のようにパーツを選択し、アニメーションを設定します。
パーツのサイズを変更すると、アニメーションもそのぶん伸び縮みします。

![アニメーションの設定](./images/append-animation.gif)

## アニメーションのタイルモード

アニメーションに「タイルモード」を設定しておくと、パーツを拡大したときにアニメーションを並べて表示できます。
以下のように、「アニメーション」ボタンを押し、先ほど追加したアニメーションを選択して「編集」ボタンを押します。「タイルモード」にチェックを入れて変更すると、
タイルモードが適用されます。

タイルモードを適用したアニメーションは、パーツを大きくしたときに画像が並べて表示されます。床や壁をつくるときに便利です。

![アニメーションのタイリング](./images/tiling.gif)

タイルモードを活用して、パーツを4つつかって床や壁をつくってみましょう。
似たようなパーツを作るときには、コピー・貼り付けをすると楽にパーツを複製できます。アイテムを選択した状態で、以下の画像の「コピー」ボタンを押すとコピーでき、
「貼り付け」ボタンを押すと複製されます。

:::tip ワンポイント
PCの場合は「Ctrl+C」でコピー、「Ctrl+V」で貼り付けることができます。
:::

![床や壁](./images/kabe.png)

## アニメーションをもっとつかってみる

床のアニメーションを変更してみましょう。新しくアニメーションを一つ追加してもよいですが、今回は別の方法を試してみます。

以下のように、先ほど作ったアニメーションにいくつかコマを追加してみます。すると、コマが一定間隔で入れ替わり、アニメーションになっていることがわかります。

![アニメーションにコマを追加](./images/add-animation-2.gif)

つぎに、再び先ほどのアニメーションを設定します。「フレーム間隔の一括設定」でフレーム間隔を0に設定します。
フレーム間隔とは、次のフレームに切り替えるまでの時間のことですが、0に設定することで次のフレームに切り替わらなくなります。

![アニメーションのコマ間隔を設定](./images/frame-0.png)

パーツを選択し、フレームを切り替えることで、表示するコマを設定できます。この方法を使えば、たくさんアニメーションを作らなくても
かんたんに静止画像を管理できます。パーツのコピー＆ペースト機能と組み合わせることで、よりすばやくマップをつくることもできます。

![アニメーションのコマを切替](./images/frame-change.gif)

## マップをたんけんしてみる

つくったマップをたんけんしてみましょう。まずはマップを保存します。PCの場合は「Ctrl+S」キーでも保存できます。

![マップを保存](./images/save.png)

マップを1度でも保存したら、たんけんの開始地点である「エントリポイント」を設置できます。
（エントリポイントはマップにただ一つだけ配置できます）

![エントリポイント](./images/entrypoint.png)

エントリポイントを設置すると、「保存してたんけん」ボタンを押すことできるようになります。

![エントリポイント](./images/playmap.png)

キャラクタを十字キーで動かすことができます。

![マップのたんけん](./images/playmap.gif)

## プラグインをつかってみる

パーツに「[プラグイン](../plugin/)」を適用すると、パーツを動かしたりすることができます。

マップにちょっと手を加えて、新たにパーツを配置します。これまでの手順を踏まえて、アニメーションを作ったり、パーツに適用したりしてみましょう。
このパーツを上下に動かして、エレベータのような動きをつくってみます。

![リフトの設置](./images/add-lift.png)

パーツを選択し、「プラグイン」をクリックします。

![プラグインの設定](./images/plugin-button.png)

プラグイン設定画面が表示されます。今回は、「直線往復移動」プラグインをつかいます。プラグインリストから「直線往復移動」を選択し、画像のように設定し、OKボタンを押します。

![直線往復移動プラグインの設定](./images/setup-plugin.png)

:::tip 設定値について
設定値の意味は以下の通りです
- 縦方向に-100の速度で動かす
- 横方向に0の速度で動かす（つまり動かさない）
- 150pxだけ移動させる

マップは左隅を原点として、右向きにX軸、下向きにY軸を取っています。なので、上向きに動かしたい場合は速度は負号をとります。
:::

この状態でマップを保存してたんけんしてみます。先ほどプラグインを適用したパーツが上下方向に動いています。

![たんけん](./images/lift.gif)

## マップをつなげてあそぶ

作ったマップをじぶんやほかのひとが作ったマップとつなげることができます。今回はじぶんのマップとつなげてみましょう。

まずは、マップに[コネクタ](../connector/)を配置します。コネクタをつかって他のマップと接続します。
キャラクタがコネクタに接触すると、設定したマップに移動します。

今回は「右」向きのコネクタを設置します。コネクタには向きがあり、「右」向きのコネクタは「左」向きのコネクタと接続できます。
また、「上」向きのコネクタは「下」向きのコネクタと接続できます。

![コネクタを追加](./images/connector.png)

コネクタもパーツと同様に、ドラッグ＆ドロップで移動したりサイズ変更できます。

![コネクタを編集](./images/connector.gif)

次に、接続先のマップをつくってみましょう。
既にマップを開いている場合は、次の手順でマップを新規作成できます。

マップを新規作成します。マップを開くボタンを押します。

![マップを開く](./images/open-map.png)

リスト内の「新規作成」を選択してOKボタンを押すと、マップが新規作成されます。

![マップを新規作成](./images/newmap.png)

:::tip ワンポイント
ログイン直後のまっさらなマップも新規作成状態です。
:::

新規作成したマップにもコネクタを設置します。今回は「左」向きのコネクタを設置します。

![コネクタを設置](./images/connector-map2.png)

コネクタの位置や大きさを調整します。ついでにエントリポイントも設置しておきます。

:::warning 注意
エントリポイントを設置していないマップとの接続はできません。
:::

![コネクタを設置](./images/connector-map2-2.png)

先ほど設置したマップと接続してみましょう。以下のようにコネクタを選択し、「接続先設定」を押すと設定画面が表示されます。「じぶんのマップ」タブ内のリストから、接続先のマップを選択し、さらにコネクタを選択してOKボタンを押すと、接続が完了します。

![コネクタを接続](./images/connect.gif)

接続したら、ためしにマップをたんけんしてみましょう。先ほど設定したコネクタに触れると、接続したマップへジャンプできます。

![コネクタで移動してみる](./images/play-connector.gif)
